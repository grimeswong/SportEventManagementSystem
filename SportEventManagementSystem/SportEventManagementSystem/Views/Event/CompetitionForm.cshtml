@model CreateEventViewModel

<div class="col-md-8">
    <h1 id='title_@ViewData["compCount"]'> Competition @((int)ViewData["compCount"] + 1)</h1>
    <div class="row">
        <div class="form-group col-md-6 col-sm-12">
            <label asp-for="@Model.Competitions[(int)ViewData["compCount"]].CompName" class="control-label"></label>
            <input asp-for="@Model.Competitions[(int)ViewData["compCount"]].CompName" class="form-control" placeholder="Competition Name" />
            <span asp-validation-for="@Model.Competitions[(int)ViewData["compCount"]].CompName" class="text-danger"></span>
        </div>
        <div class="form-group col-md-3 col-sm-6">
            <label class="control-label">Division</label>
            <input class="form-control" placeholder="Division" />
            @*<span asp-validation-for="CompName" class="text-danger"></span>*@  <!-- For data validation -->
        </div>
        <div class="form-group col-md-3 col-sm-6">
            <label class="control-label">Sport Type</label>
            <input class="form-control" placeholder="Sport Type" />
            @*<span asp-validation-for="CompName" class="text-danger"></span>*@  <!-- For data validation -->
        </div>
    </div>
    <div class="row">
        <div class="form-group col-md-6 col-sm-12">
            <label class="control-label">Competition Location</label>
            <input class="form-control" placeholder="Competition Name" />
            @*<span asp-validation-for="CompName" class="text-danger"></span>*@  <!-- For data validation -->
        </div>
        <div class="form-group col-md-3 col-sm-6">
            <label class="control-label">Start Time</label>
            <input class="form-control datetimepicker" placeholder="Start Time" />
            @*<span asp-validation-for="CompName" class="text-danger"></span>*@  <!-- For data validation -->
        </div>
        <div class="form-group col-md-3 col-sm-6">
            <label class="control-label">End Time</label>
            <input class="form-control datetimepicker" placeholder="End Time" />
            @*<span asp-validation-for="CompName" class="text-danger"></span>*@  <!-- For data validation -->
        </div>
    </div>
    <div class="row">
        <div class="form-group col-md-4 col-sm-4">
            <label class="control-label">Entry Capacity</label>
            <input class="form-control" placeholder="Entry Capacity" />
            @*<span asp-validation-for="CompName" class="text-danger"></span>*@  <!-- For data validation -->
        </div>
        <div class="form-group col-md-4 col-sm-4">
            <label class="control-label">Team Minimum No.</label>
            <input class="form-control" placeholder="Team Minimum No." />
            @*<span asp-validation-for="CompName" class="text-danger"></span>*@  <!-- For data validation -->
        </div>
        <div class="form-group col-md-4 col-sm-4">
            <label class="control-label">Team Maximum No.</label>
            <input class="form-control" placeholder="Team Maximum No." />
            @*<span asp-validation-for="CompName" class="text-danger"></span>*@  <!-- For data validation -->
        </div>
    </div>
    <div class="row">
        <div class="form-group col-md-4 col-sm-4">
            <label class="control-label">Minimum Age</label>
            <input class="form-control" placeholder="Minimum Age" />
            @*<span asp-validation-for="CompName" class="text-danger"></span>*@  <!-- For data validation -->
        </div>
        <div class="form-group col-md-4 col-sm-4">
            <label class="control-label">Maxmium Age</label>
            <input class="form-control" placeholder="Maximum Age" />
            @*<span asp-validation-for="CompName" class="text-danger"></span>*@  <!-- For data validation -->
        </div>
        <div class="form-group col-md-4 col-sm-4">
            <label class="control-label">Gender Restriction</label>
            <select>
                <option value="0" selected>Please select an option.</option>
                <option value="1">Male</option>
                <option value="2">Female</option>
                <option value="3">Mixed</option>
            </select>
            <span class="text-danger"></span>
            @*<input class="form-control" placeholder="Gender Restriction" />*@
            @*<span asp-validation-for="CompName" class="text-danger"></span>*@  <!-- For data validation -->
        </div>


    </div>
</div> <!-- end of left details column -->
<div class="col-md-4">
    <img class="create-img" src="~/images/banner1.jpg" alt="Image not available" />
    <p>Add a photo</p>
</div> <!-- end of right image column -->
<!-- Save Competition Buttons -->
<div class="col-md-12">
    <button class="btn btn-default btn-lg" id='removeCompetitionBtn_@ViewData["compCount"]' type="button">Remove Competition</button>
</div> <!-- End of save cpmpetition buttons-->

<script>
    var removeBtn = $("#removeCompetitionBtn_" +@ViewData["compCount"]);
    removeBtn.on("click", function (e) {
        console.log("checking form");
        //Remove compForm from main event form
        var num = e.currentTarget.getAttribute("competitionId");
        $(this).parents("[id ^= 'compForm']").eq(0).remove();
        //Update competition counter
        var newCompCount = parseInt($("#CompetitionCount").val()) - 1;
        $("#CompetitionCount").val(newCompCount);

        //Fix indexes of remaining elements
        var i = 0;
        $("#EventForm").find("#compFormMain [id ^='compForm']").each(function () { //Loop over each Competition Form
            //Update comp form class name
            this.id = this.id.replace(/compForm.*/, "compForm" + i);
            $(this).find("h1, input, label, span, button").each(function () { //Loop over each form element
                //Update elements to new sequential indexes
                //Loop over each attribute and see if it matches our regex
                for (var j = 0; j < $(this)[0].attributes.length; j++) {

                    //Replace banner id and update value
                    if ($(this)[0].attributes[j].value.startsWith("title_")) {
                        console.log("running");
                        $(this)[0].attributes[j].value.replace(/title_.*/, "title_" + i);
                        $(this)[0].innerText = "Competition " + (i+1);
                    }

                    //Regex to get index from string in format of _index__

                    var matches = $(this)[0].attributes[j].value.match(/_(.*?)__/);
                    //Since regex matches full string plus second occurance is the one we are looking for check its longer then one
                    if (matches && matches.length > 1) {
                        //If it is longer then 1 then replace the matched index with our new updated index
                        $(this)[0].attributes[j].value = $(this)[0].attributes[j].value.replace(matches[1], i);
                    }

                    //Regex to get index from string in format of Competitions[index]
                    matches = $(this)[0].attributes[j].value.match(/Competitions\[(.*?)\]/);
                    if (matches && matches.length > 1) {
                        //If it is longer then 1 then replace the matched index with our new updated index
                        $(this)[0].attributes[j].value = $(this)[0].attributes[j].value.replace(matches[1], i);
                    }
                    if ($(this)[0].attributes[j].value.indexOf(/removeCompetitionBtn_.*/) != -1) {
                        $(this)[0].attributes[j].value.replace(/removeCompetitionBtn_.*/, "removeCompetitionBtn_" + i);
                    }

                }
            })
            i++;
        });
    });
</script>